name: Build LaTeX Resume

on:
  push:
  workflow_dispatch:

permissions:
  contents: write  # needed to push the compiled PDF back

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Change RESUME_TEX if your main .tex file is named differently
      - name: Set variables
        run: |
          echo "RESUME_TEX=resume.tex" >> $GITHUB_ENV
          echo "OUTPUT_PDF=Resume.pdf" >> $GITHUB_ENV

      - name: Compile LaTeX
        uses: xu-cheng/latex-action@v3
        with:
          root_file: ${{ env.RESUME_TEX }}
          compiler: xelatex
          args: -interaction=nonstopmode -halt-on-error -file-line-error
          # If you need extra fonts/packages, uncomment and add them:
          # extra_system_packages: "fonts-noto texlive-fonts-recommended"

      - name: Prepare docs folder
        run: |
          mkdir -p docs
          # strip the .tex extension safely using bash parameter expansion
          src="${{ env.RESUME_TEX }}"
          pdf="${src%.tex}.pdf"
          mv "$pdf" "docs/${{ env.OUTPUT_PDF }}"

      - name: Upload artifact (optional)
        uses: actions/upload-artifact@v4
        with:
          name: resume-pdf
          path: docs/${{ env.OUTPUT_PDF }}

      - name: Commit PDF back to repo
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore(ci): auto-build resume PDF"
          file_pattern: docs/${{ env.OUTPUT_PDF }}
